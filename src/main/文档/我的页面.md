# 我的页面接口文档

接口基地址：`http://localhost:5000/api/profile`  
允许跨域来源：`http://localhost:5173`

---

## 1. 设置偏好

- **方法 & 路径**：`POST /preferences`
- **说明**：保存/更新用户的选房偏好数据，写入 `user_preferences` 表。
- **请求体参数**：
  | 字段 | 类型 | 必填 | 说明 |
  | ---- | ---- | ---- | ---- |
  | `userId` | Long | 是 | 用户 ID |
  | `preferenceData` | Object | 是 | 任意 JSON（价格区间、户型、区域等） |
- **请求示例**：
```json
{
  "userId": 1,
  "preferenceData": {
    "price_range": {"min": 300, "max": 600},
    "main_districts": ["南山区", "福田区"],
    "house_types": ["apartment"]
  }
}
```
- **响应示例（201）**：
```json
{
  "message": "偏好设置成功",
  "userId": 1
}
```
- **错误响应**：400（缺少参数）、500（写入失败）

---

## 2. 房价预测

- **方法 & 路径**：`POST /price-predict`
- **说明**：接收前端提交的房源特征，返回固定示例预测结果（1 万元/㎡）。后续可接入真实模型。
- **请求体示例**：
```json
{
  "city": "深圳",
  "district": "南山区",
  "area": 89.5,
  "bedroom": 3,
  "decoration": "hard"
}
```
- **响应示例（200）**：
```json
{
  "input": {
    "city": "深圳",
    "district": "南山区",
    "area": 89.5,
    "bedroom": 3,
    "decoration": "hard"
  },
  "predictedPricePerSquareMeter": 1,
  "unit": "万元/㎡",
  "message": "预测成功（示例值，后续可替换为真实算法）"
}
```

---

## 3. 历史记录

- **方法 & 路径**：`GET /history`
- **说明**：根据 `userId` 查询 `browsing_history` 表，并关联 `properties`，返回用户浏览过的房源记录。
- **请求参数**：
  | 参数 | 类型 | 必填 | 说明 |
  | ---- | ---- | ---- | ---- |
  | `userId` | Long | 是 | 用户 ID |
- **请求示例**：`GET /api/profile/history?userId=1`
- **响应示例**：
```json
{
  "items": [
    {
      "historyId": 12,
      "propertyId": 101,
      "title": "万科城市花园 精装三房 南向采光好",
      "behaviorData": {"duration": 36, "device": "mobile"},
      "priceInfo": {"total_price": 650.5, "unit_price": 85000},
      "layoutInfo": {"bedroom_count": 3, "area": 89.5},
      "createdAt": "2025-03-03T10:20:30"
    }
  ],
  "count": 1,
  "message": "历史记录获取成功"
}
```
- **错误响应**：500（SQL/连接异常）

---

## 数据库说明

- 数据脚本：`src/main/resources/script.sql`
- 主要表：
  - `user_preferences`：存储用户偏好 JSON
  - `browsing_history`：用户浏览记录
  - `properties`：房源基础信息（JSON 字段：`price_info`, `layout_info`, `basic_info`）
- 控制器直接使用 JDBC（参数来自 `application.properties` 的 `spring.datasource.*`）

---

## 调试建议

1. 确认数据库已按脚本创建，且具备最基本测试数据。
2. 若偏好写入失败，请检查 `userId` 是否存在于 `users` 表。
3. 历史记录依赖 `browsing_history` + `properties` 联查，确保满足外键约束。
4. 房价预测现为固定值返回，可在接口内接入实际算法或调用外部服务。


