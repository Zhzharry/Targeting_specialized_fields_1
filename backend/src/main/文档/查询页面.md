# 查询页面接口文档

接口基地址：`http://localhost:5000/api/query`  
允许跨域来源：`http://localhost:5173`

---

## 房源查询接口

- **方法 & 路径**：`GET /api/query`
- **说明**：根据关键字与多种筛选条件，查询 `second_hand_housing` 数据库中的 `properties` 与 `communities` 表，返回房源列表。
- **请求参数**：
  | 参数 | 类型 | 必填 | 说明 |
  | ---- | ---- | ---- | ---- |
  | `keyword` | String | 否 | 标题或小区名称模糊匹配 |
  | `district` | String | 否 | 行政区（`communities.location_info.district`） |
  | `minPrice` / `maxPrice` | Double | 否 | 总价范围（万元，`price_info.total_price`） |
  | `propertyType` | String | 否 | 房源类型（`basic_info.property_type`，如 `apartment`） |
  | `orientation` | String | 否 | 朝向（`layout_info.orientation`） |
  | `status` | String | 否 | 房源状态（`for_sale`/`sold`） |
  | `minBedrooms` / `maxBedrooms` | Integer | 否 | 户型卧室数范围（`layout_info.bedroom_count`） |
  | `minArea` / `maxArea` | Double | 否 | 面积范围（㎡，`layout_info.area`） |
  | `minViewCount` / `maxViewCount` | Integer | 否 | 浏览次数范围 |

- **请求示例**：  
  `GET /api/query?keyword=万科&district=南山区&propertyType=apartment&minBedrooms=3&maxPrice=800`

- **响应示例**：
```json
{
  "items": [
    {
      "propertyId": 101,
      "title": "万科城市花园 精装三房 南向采光好",
      "status": "for_sale",
      "communityName": "万科城市花园",
      "viewCount": 35,
      "favoriteCount": 8,
      "updatedAt": "2025-03-01T12:34:56",
      "priceInfo": {
        "total_price": 650.5,
        "unit_price": 85000
      },
      "layoutInfo": {
        "bedroom_count": 3,
        "living_room_count": 2,
        "bathroom_count": 2,
        "area": 89.5
      },
      "basicInfo": {
        "property_type": "apartment",
        "build_year": 2018
      },
      "locationInfo": {
        "province": "广东省",
        "city": "深圳市",
        "district": "南山区"
      }
    }
  ],
  "count": 1,
  "message": "查询成功"
}
```

- **错误响应**：
  - 500：`{"message":"查询失败","error":"SQL 异常信息"}`

---

## 数据来源说明

- 数据库脚本：`src/main/resources/script.sql`
- 主要表结构：
  - `properties`：房源详情（title/basic_info/price_info/layout_info等 JSON 字段）
  - `communities`：小区信息与位置信息（location_info JSON）
- 接口通过 JDBC 直接执行查询，连接参数来自 `application.properties` (`spring.datasource.*`)。

---

## 调试建议

1. 确保 MySQL 已按 `script.sql` 初始化，并导入示例数据。
2. 若需继续扩展筛选条件，可在 `QueryController` 中追加新的 `@RequestParam` 和 SQL 片段。
3. 如遇 500 错误，检查后端日志确认 SQL 语句和参数是否正确。