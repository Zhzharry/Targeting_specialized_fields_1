# 查询页面接口文档

接口基地址：`http://localhost:5000/api/query`  
允许跨域来源：`http://localhost:5173`

---

## 房源查询接口

- **方法 & 路径**：`GET /api/query`
- **说明**：根据关键字与筛选条件，查询 `second_hand_housing` 数据库中的 `properties` 与 `communities` 表，并返回房源列表。
- **请求参数**：
  | 参数 | 类型 | 说明 | 示例 |
  | ---- | ---- | ---- | ---- |
  | `keyword` | String | 选填。按房源标题或小区名称模糊匹配 | `万科` |
  | `district` | String | 选填。按行政区精确匹配（来自 `communities.location_info` 中 `district` 字段） | `南山区` |
  | `minPrice` | Double | 选填。最低总价（万元），对应 `price_info.total_price` | `500` |
  | `maxPrice` | Double | 选填。最高总价（万元） | `800` |

- **请求示例**：  
  `GET /api/query?keyword=万科&district=南山区&minPrice=400&maxPrice=800`

- **响应示例**：
```json
{
  "items": [
    {
      "propertyId": 101,
      "title": "万科城市花园 精装三房 南向采光好",
      "status": "for_sale",
      "communityName": "万科城市花园",
      "viewCount": 35,
      "favoriteCount": 8,
      "updatedAt": "2025-03-01T12:34:56",
      "priceInfo": {
        "total_price": 650.5,
        "unit_price": 85000
      },
      "layoutInfo": {
        "bedroom_count": 3,
        "living_room_count": 2,
        "bathroom_count": 2,
        "area": 89.5
      },
      "basicInfo": {
        "property_type": "apartment",
        "build_year": 2018
      },
      "locationInfo": {
        "province": "广东省",
        "city": "深圳市",
        "district": "南山区"
      }
    }
  ],
  "count": 1,
  "message": "查询成功"
}
```

- **错误响应**：
  - 500：`{"message":"查询失败","error":"SQL 异常信息"}`

---

## 数据来源说明

- 数据库脚本：`src/main/resources/script.sql`
- 主要表结构：
  - `properties`：房源详情（title/basic_info/price_info/layout_info等 JSON 字段）
  - `communities`：小区信息与位置信息（location_info JSON）
- 接口通过 JDBC 直接执行查询，连接参数来自 `application.properties` (`spring.datasource.*`)。

---

## 调试建议

1. 确保 MySQL 已按 `script.sql` 初始化，并导入示例数据。
2. 若需扩展筛选条件，可在 `QueryController` 中调整 SQL 及参数拼装逻辑。
3. 如遇 500 错误，检查后端日志中的 SQL 语句与参数是否正确。

# 查询页面接口文档

- **后端地址**：`http://localhost:5000`
- **接口根路径**：`/api/query`
- **跨域来源**：`http://localhost:5173`

---

## 1. 查询接口

- **方法**：`GET`
- **完整路径**：`GET /api/query`
- **说明**：接收前端输入的关键字并返回匹配结果。当前为示例实现，返回固定数据；后续可根据关键字查询数据库中真实房源或小区信息。

### 请求参数
| 参数名   | 类型   | 是否必填 | 说明         |
|----------|--------|----------|--------------|
| keyword  | String | 否       | 查询关键字。为空时返回默认示例。 |

### 请求示例
```
GET /api/query?keyword=万科
```

### 响应示例（200）
```json
{
  "keyword": "万科",
  "items": [
    "示例结果1",
    "示例结果2"
  ],
  "message": "查询成功（示例数据）"
}
```

### 备注
1. `items` 字段目前为字符串数组，可根据需求调整为包含房源详情的对象列表。
2. 若需要增加分页或过滤条件，可在查询参数中扩展 `page`、`size`、`filters` 等字段，并在后端实现对应逻辑。
3. 后续接入真实查询时，可参考 `script.sql` 中的表结构（如 `properties`、`communities`）进行 SQL 检索。

